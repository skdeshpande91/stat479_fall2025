<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>STAT 479: Lecture 4 – STAT479</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-4bfb630b09c0e164834af1bb3207dbff.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">STAT479</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../syllabus.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-lecture-code" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Lecture Code</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-lecture-code">    
        <li>
    <a class="dropdown-item" href="../../lectures/lecture00.html">
 <span class="dropdown-text">Lecture 0: Boxscore Metrics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../lectures/lecture02.html">
 <span class="dropdown-text">Lecture 2: Expected Goals</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../lectures/lecture03.html">
 <span class="dropdown-text">Lecture 3: Estimating XG</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../lectures/lecture04.html">
 <span class="dropdown-text">Lecture 4: Adjusted Plus/Minus</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../lectures/lecture05.html">
 <span class="dropdown-text">Lecture 5: Regularized Adjusted Plus/Minus</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../lectures/lecture06.html">
 <span class="dropdown-text">Lecture 6: Run Expectancy</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../lectures/lecture07.html">
 <span class="dropdown-text">Lecture 7: Offensive Credit Allocation in Baseball</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../lectures/lecture08.html">
 <span class="dropdown-text">Lecture 8: Defensive Credit Allocation in Baseball</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../lectures/lecture09.html">
 <span class="dropdown-text">Lecture 9: Multilevel Modeling</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../lectures/lecture10.html">
 <span class="dropdown-text">Lecture 10: NFl WAR</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../lectures/lecture11.html">
 <span class="dropdown-text">Lecture 11: Pitch Framing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../lectures/lecture12.html">
 <span class="dropdown-text">Lecture 12: Power Rankings I</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../lectures/lecture13.html">
 <span class="dropdown-text">Lecture 13: Power Rankings II</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-lecture-slides" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Lecture Slides</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-lecture-slides">    
        <li>
    <a class="dropdown-item" href="../../slides/lecture01.html">
 <span class="dropdown-text">Lecture 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../slides/lecture02.html">
 <span class="dropdown-text">Lecture 2: Expected Goals</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../slides/lecture03.html">
 <span class="dropdown-text">Lecture 3: Estimating XG</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../slides/lecture04.html">
 <span class="dropdown-text">Lecture 4: Adjusted Plus/Minus</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../slides/lecture05.html">
 <span class="dropdown-text">Lecture 5: Regularized Adjusted Plus/Minus</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../slides/lecture06.html">
 <span class="dropdown-text">Lecture 6: Expected Runs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../slides/lecture08.html">
 <span class="dropdown-text">Lecture 8: Defensive Credit Allocation &amp; WAR</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#motivation" id="toc-motivation" class="nav-link active" data-scroll-target="#motivation">Motivation</a></li>
  <li><a href="#plusminus" id="toc-plusminus" class="nav-link" data-scroll-target="#plusminus">Plus/Minus</a></li>
  <li><a href="#play-by-play-nba-data" id="toc-play-by-play-nba-data" class="nav-link" data-scroll-target="#play-by-play-nba-data">Play-by-Play NBA Data</a></li>
  <li><a href="#stint-level-data" id="toc-stint-level-data" class="nav-link" data-scroll-target="#stint-level-data">Stint-Level Data</a></li>
  <li><a href="#data-snapshot" id="toc-data-snapshot" class="nav-link" data-scroll-target="#data-snapshot">Data Snapshot</a></li>
  <li><a href="#plusminus-1" id="toc-plusminus-1" class="nav-link" data-scroll-target="#plusminus-1">Plus/Minus</a>
  <ul class="collapse">
  <li><a href="#computing-individual---concept" id="toc-computing-individual---concept" class="nav-link" data-scroll-target="#computing-individual---concept">Computing Individual +/- (Concept)</a></li>
  <li><a href="#computing-individual---formula" id="toc-computing-individual---formula" class="nav-link" data-scroll-target="#computing-individual---formula">Computing Individual +/- (Formula)</a></li>
  <li><a href="#computing-individual---code" id="toc-computing-individual---code" class="nav-link" data-scroll-target="#computing-individual---code">Computing Individual +/- (Code)</a></li>
  </ul></li>
  <li><a href="#digression-matrix-computation" id="toc-digression-matrix-computation" class="nav-link" data-scroll-target="#digression-matrix-computation">Digression: Matrix Computation</a>
  <ul class="collapse">
  <li><a href="#notation" id="toc-notation" class="nav-link" data-scroll-target="#notation">Notation</a></li>
  <li><a href="#stint-design-matrix" id="toc-stint-design-matrix" class="nav-link" data-scroll-target="#stint-design-matrix">Stint Design Matrix</a></li>
  <li><a href="#computing-all--s" id="toc-computing-all--s" class="nav-link" data-scroll-target="#computing-all--s">Computing all +/-’s</a></li>
  <li><a href="#computing-plusminus" id="toc-computing-plusminus" class="nav-link" data-scroll-target="#computing-plusminus">Computing Plus/Minus</a></li>
  <li><a href="#visualizing-plusminus" id="toc-visualizing-plusminus" class="nav-link" data-scroll-target="#visualizing-plusminus">Visualizing Plus/Minus</a></li>
  <li><a href="#plusminus-and-possessions" id="toc-plusminus-and-possessions" class="nav-link" data-scroll-target="#plusminus-and-possessions">Plus/Minus and Possessions</a></li>
  <li><a href="#issues-with-plusminus" id="toc-issues-with-plusminus" class="nav-link" data-scroll-target="#issues-with-plusminus">Issues with Plus/Minus</a></li>
  </ul></li>
  <li><a href="#adjusted-plusminus" id="toc-adjusted-plusminus" class="nav-link" data-scroll-target="#adjusted-plusminus">Adjusted Plus/Minus</a>
  <ul class="collapse">
  <li><a href="#from-totals-to-rates" id="toc-from-totals-to-rates" class="nav-link" data-scroll-target="#from-totals-to-rates">From Totals to Rates</a></li>
  <li><a href="#an-initial-apm-model" id="toc-an-initial-apm-model" class="nav-link" data-scroll-target="#an-initial-apm-model">An Initial APM Model</a></li>
  <li><a href="#interpretation" id="toc-interpretation" class="nav-link" data-scroll-target="#interpretation">Interpretation</a></li>
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example">Example</a></li>
  <li><a href="#apm-as-a-linear-model" id="toc-apm-as-a-linear-model" class="nav-link" data-scroll-target="#apm-as-a-linear-model">APM As A Linear Model</a></li>
  <li><a href="#singularity" id="toc-singularity" class="nav-link" data-scroll-target="#singularity">Singularity</a></li>
  <li><a href="#non-identifiability" id="toc-non-identifiability" class="nav-link" data-scroll-target="#non-identifiability">Non-identifiability</a></li>
  <li><a href="#baseline-contrasts" id="toc-baseline-contrasts" class="nav-link" data-scroll-target="#baseline-contrasts">Baseline Contrasts</a></li>
  <li><a href="#a-re-parametrized-model" id="toc-a-re-parametrized-model" class="nav-link" data-scroll-target="#a-re-parametrized-model">A Re-parametrized Model</a></li>
  <li><a href="#estimating-boldsymbolbeta" id="toc-estimating-boldsymbolbeta" class="nav-link" data-scroll-target="#estimating-boldsymbolbeta">Estimating <span class="math inline">\(\boldsymbol{\beta}\)</span></a></li>
  </ul></li>
  <li><a href="#weighted-adjusted-plusminus" id="toc-weighted-adjusted-plusminus" class="nav-link" data-scroll-target="#weighted-adjusted-plusminus">Weighted Adjusted Plus/Minus</a>
  <ul class="collapse">
  <li><a href="#missing-context" id="toc-missing-context" class="nav-link" data-scroll-target="#missing-context">Missing Context</a></li>
  <li><a href="#a-weighted-version-of-apm" id="toc-a-weighted-version-of-apm" class="nav-link" data-scroll-target="#a-weighted-version-of-apm">A Weighted Version of APM</a></li>
  <li><a href="#estimating-wapm" id="toc-estimating-wapm" class="nav-link" data-scroll-target="#estimating-wapm">Estimating wAPM</a></li>
  <li><a href="#looking-ahead" id="toc-looking-ahead" class="nav-link" data-scroll-target="#looking-ahead">Looking Ahead</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="slides_04.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">STAT 479: Lecture 4</h1>
<p class="subtitle lead">Adjusted Plus/Minus</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="motivation" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="motivation">Motivation</h2>
<ul>
<li>How do NBA players help their teams win?</li>
<li>How do we quantify contributions?</li>
</ul>
<p>. . .</p>
<ul>
<li>Idea: good players do things that show up in the box score
<ul>
<li>Points, rebounds, assists, steals, blocks, turnovers</li>
<li>Easy to collect, sort, explain</li>
</ul></li>
</ul>
<p>. . .</p>
<ul>
<li>Fails to account for roles
<ul>
<li>10 assists for a guard vs 10 rebounds by a center</li>
</ul></li>
<li>Problem: should some stats weigh more heavily than others?</li>
</ul>
<p>. . .</p>
<ul>
<li>Bigger problem: Not everything appears in the box score
<ul>
<li>Setting screens, rotating on defense, communicating</li>
<li>Good shot selection, diving for loose balls</li>
<li>The “little things”</li>
</ul></li>
</ul>
</section>
<section id="plusminus" class="level2">
<h2 class="anchored" data-anchor-id="plusminus">Plus/Minus</h2>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Definition: Plus/Minus
</div>
</div>
<div class="callout-body-container callout-body">
<p>A player’s <strong>plus/minus</strong> is the point differential that a player’s team accrues while they are on the court.</p>
</div>
</div>
<ul>
<li><p>Intuition: if your team outscores opponent while you’re on the court, you must be doing something right</p></li>
<li><p>To compute, must know who is on the court at all times</p></li>
</ul>
</section>
<section id="play-by-play-nba-data" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="play-by-play-nba-data">Play-by-Play NBA Data</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="nba_pbp_screenshot.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="nba_pbp_screenshot.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:60.0%"></a></p>
</figure>
</div>
<ul>
<li>Entry created when player does something tracked by scorekeeper</li>
<li>Can use the <strong>hoopR</strong> package to scrape play-by-play data into R</li>
</ul>
</section>
<section id="stint-level-data" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="stint-level-data">Stint-Level Data</h2>
<ul>
<li><p>Stint: period of play b/w substitutions where the same 10 players remain on the court.</p></li>
<li><p>Can form a data table from play-by-play log where</p>
<ul>
<li>Rows correspond to stints</li>
<li>Columns for game context: start &amp; end scores, length in minutes, etc.</li>
<li>Column for every player’s <em>signed on-court indicator</em></li>
</ul></li>
<li><p>Signed on-court indicators:</p>
<ul>
<li>+1 if on-court and playing at home</li>
<li>-1 if on-court and playing on the road</li>
<li>0 if not on court</li>
</ul></li>
</ul>
</section>
<section id="data-snapshot" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="data-snapshot">Data Snapshot</h2>
<ul>
<li>Context columns:
<ul>
<li>Game &amp; Stint ID; num. possessions; duration;</li>
<li>Start &amp; end scores &amp; times; point differential</li>
</ul></li>
<li>569 columns of signed on-court indicators</li>
</ul>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Context</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">On-Court Indicators</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Player IDs</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 7
  stint_id n_pos start_minutes minutes home_points away_points pts_diff
     &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;    &lt;dbl&gt;
1        1    14          0      5.42           18          12        6
2        2     5          5.42   1.51            2           2        0
3        3     1          6.93   0.220           0           2       -2
4        4     4          7.15   2.17            9           1        8
5        5    13          9.32   4.13           13          11        2</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 7
  stint_id `201143` `201950` `1627759` `1628369` `1628436` `1630202`
     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1        1        1        1         1         1         0         0
2        2        1        0         0         1         1         1
3        3        1        0         0         1         1         1
4        4        0        0         0         1         1         1
5        5        0        1         0         1         1         1</code></pre>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>player_table <span class="ot">&lt;-</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>  hoopR<span class="sc">::</span><span class="fu">nba_commonallplayers</span>()[[<span class="st">"CommonAllPlayers"</span>]] <span class="sc">|&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(PERSON_ID, DISPLAY_FIRST_LAST) <span class="sc">|&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">id =</span> PERSON_ID, <span class="at">FullName =</span> DISPLAY_FIRST_LAST) <span class="sc">|&gt;</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb3-6"><a href="#cb3-6"></a>    <span class="at">Name =</span> stringi<span class="sc">::</span><span class="fu">stri_trans_general</span>(FullName, <span class="st">"Latin-ASCII"</span>)) </span>
<span id="cb3-7"><a href="#cb3-7"></a></span>
<span id="cb3-8"><a href="#cb3-8"></a>player_table <span class="sc">|&gt;</span></span>
<span id="cb3-9"><a href="#cb3-9"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"201143"</span>, <span class="st">"201950"</span>, <span class="st">"1627759"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb3-10"><a href="#cb3-10"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(FullName)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Jaylen Brown" "Jrue Holiday" "Al Horford"  </code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="plusminus-1" class="level1">
<h1>Plus/Minus</h1>
<section id="computing-individual---concept" class="level2">
<h2 class="anchored" data-anchor-id="computing-individual---concept">Computing Individual +/- (Concept)</h2>
<ul>
<li><p>Consider Shai Gilgeous-Alexander (2024-25 MVP)</p></li>
<li><p>To compute SGA’s +/-:</p>
<ol type="1">
<li>Sum the home team point differentials for all stints where SGA was on the court and playing at home.</li>
<li>Sum the <em>negative</em> of the home team point differentials for all shifts where SGA was on the court and playing on the road.</li>
<li>Add the two totals from Steps 1 and 2.</li>
</ol></li>
</ul>
</section>
<section id="computing-individual---formula" class="level2">
<h2 class="anchored" data-anchor-id="computing-individual---formula">Computing Individual +/- (Formula)</h2>
<ul>
<li><span class="math inline">\(\Delta_{i}\)</span>: home team point differential in shift <span class="math inline">\(i\)</span></li>
<li><span class="math inline">\(x_{i, \textrm{SGA}}\)</span>: SGA’s signed on-court indicator:
<ul>
<li><span class="math inline">\(x_{i, \textrm{SGA}} = 0\)</span> if SGA off-court in stint <span class="math inline">\(i\)</span></li>
<li><span class="math inline">\(x_{i, \textrm{SGA}} = 1(-1)\)</span> if SGA on-court at home (away) in stint <span class="math inline">\(i\)</span></li>
</ul></li>
<li>SGA’s +/- is just <span class="math display">\[
\sum_{i = 1}^{n}{x_{i,\textrm{SGA}} \times \Delta_{i}}.
\]</span></li>
</ul>
</section>
<section id="computing-individual---code" class="level2">
<h2 class="anchored" data-anchor-id="computing-individual---code">Computing Individual +/- (Code)</h2>
<ul>
<li>When SGA was on the floor, Thunder outscored opponents by 888 pts</li>
<li>When Jokic was on the floor, Nuggets outscored opponents by 452</li>
</ul>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">SGA</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Jokic</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>shai_id <span class="ot">&lt;-</span> player_table <span class="sc">|&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Name <span class="sc">==</span> <span class="st">"Shai Gilgeous-Alexander"</span>) <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(id) </span>
<span id="cb5-3"><a href="#cb5-3"></a>shai_x <span class="ot">&lt;-</span> rapm_data <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(shai_id) </span>
<span id="cb5-4"><a href="#cb5-4"></a>delta <span class="ot">&lt;-</span> rapm_data <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(pts_diff) </span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="fu">sum</span>(shai_x <span class="sc">*</span> delta)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 888</code></pre>
</div>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>jokic_id <span class="ot">&lt;-</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  player_table <span class="sc">|&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Name <span class="sc">==</span> <span class="st">"Nikola Jokic"</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(id)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>jokic_x <span class="ot">&lt;-</span> rapm_data <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(jokic_id) </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(jokic_x <span class="sc">*</span> delta) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 452</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="digression-matrix-computation" class="level1">
<h1>Digression: Matrix Computation</h1>
<section id="notation" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="notation">Notation</h2>
<ul>
<li><p><span class="math inline">\(n\)</span>: total number of stints in the season</p></li>
<li><p><span class="math inline">\(p\)</span>: total number of players</p></li>
<li><p>For each stint <span class="math inline">\(i = 1, \ldots, n\)</span> and player <span class="math inline">\(j = 1, \ldots, p\)</span>:</p>
<ul>
<li><span class="math inline">\(x_{ij} = 1\)</span> if player <span class="math inline">\(j\)</span> on-court at home in stint <span class="math inline">\(i\)</span></li>
<li><span class="math inline">\(x_{ij} = -1\)</span> if player <span class="math inline">\(j\)</span> on-court on road in stint <span class="math inline">\(i\)</span></li>
<li><span class="math inline">\(x_{ij} = 0\)</span></li>
</ul></li>
<li><p><span class="math inline">\(\Delta_{i}\)</span>: home-team differential in stint <span class="math inline">\(i\)</span> . . .</p></li>
<li><p>Player <span class="math inline">\(j\)</span>’s +/-: <span class="math inline">\(\sum_{i}{x_{ij}\Delta_{i}}\)</span></p></li>
</ul>
</section>
<section id="stint-design-matrix" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="stint-design-matrix">Stint Design Matrix</h2>
<ul>
<li>Arrange <span class="math inline">\(x_{ij}\)</span>’s into an <span class="math inline">\(n \times p\)</span> matrix</li>
</ul>
<p><span class="math display">\[
\boldsymbol{\mathbf{X}} =
\begin{pmatrix}
x_{1,1} &amp; \cdots &amp; x_{1,p} \\
\vdots &amp; &amp; \vdots \\
x_{n,1} &amp; \cdots &amp; x_{n,p}
\end{pmatrix}
\]</span></p>
<p>. . .</p>
<ul>
<li>Collect all <span class="math inline">\(n\)</span> <span class="math inline">\(\Delta_{i}\)</span>’s into a vector of length <span class="math inline">\(n\)</span> <span class="math display">\[
\boldsymbol{\Delta} = \begin{pmatrix} \Delta_{1} \\ \vdots \\ \Delta_{n} \end{pmatrix}
\]</span></li>
</ul>
</section>
<section id="computing-all--s" class="level2">
<h2 class="anchored" data-anchor-id="computing-all--s">Computing all +/-’s</h2>
<ul>
<li>Can compute <strong>all</strong> player’s w/ matrix-vector multiplication <span class="math inline">\(\boldsymbol{\mathbf{X}}^{\top}\boldsymbol{\Delta}\)</span> <span class="math display">\[
\begin{pmatrix}
x_{1,1} &amp; \cdots &amp; x_{n,1} \\
\vdots &amp; &amp; \vdots \\
x_{1,p} &amp; \cdots &amp; x_{n,p}
\end{pmatrix}
\begin{pmatrix} \Delta_{1} \\ \vdots \\ \Delta_{n} \end{pmatrix}
=
\begin{pmatrix}
x_{1,1}\Delta_{1} + x_{2,1}\Delta_{2} + \cdots + x_{n,1}\Delta_{n}\\
\vdots \\
x_{1,p}\Delta_{1} + x_{2,p}\Delta_{2} + \cdots + x_{n,p}\Delta_{n}
\end{pmatrix}
\]</span></li>
</ul>
</section>
<section id="computing-plusminus" class="level2">
<h2 class="anchored" data-anchor-id="computing-plusminus">Computing Plus/Minus</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Building <span class="math inline">\(\boldsymbol{\mathbf{X}}\)</span></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Computing Plus/Minus</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false">Selected Players</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-13"><pre class="sourceCode r code-annotation-code code-with-copy"><code class="sourceCode r"><span id="annotated-cell-13-1"><a href="#annotated-cell-13-1" aria-hidden="true" tabindex="-1"></a>context_vars <span class="ot">&lt;-</span></span>
<span id="annotated-cell-13-2"><a href="#annotated-cell-13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"game_id"</span>, <span class="st">"stint_id"</span>, <span class="st">"n_pos"</span>, </span>
<span id="annotated-cell-13-3"><a href="#annotated-cell-13-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"start_home_score"</span>, <span class="st">"start_away_score"</span>, <span class="st">"start_minutes"</span>,</span>
<span id="annotated-cell-13-4"><a href="#annotated-cell-13-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"end_home_score"</span>, <span class="st">"end_away_score"</span>, <span class="st">"end_minutes"</span>,</span>
<span id="annotated-cell-13-5"><a href="#annotated-cell-13-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"home_points"</span>, <span class="st">"away_points"</span>, <span class="st">"minutes"</span>,</span>
<span id="annotated-cell-13-6"><a href="#annotated-cell-13-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pts_diff"</span>, <span class="st">"margin"</span>)</span>
<span id="annotated-cell-13-7"><a href="#annotated-cell-13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-13-8"><a href="#annotated-cell-13-8" aria-hidden="true" tabindex="-1"></a>X_full <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>( </span>
<span id="annotated-cell-13-9"><a href="#annotated-cell-13-9" aria-hidden="true" tabindex="-1"></a>    rapm_data <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span> tidyr<span class="sc">::</span><span class="fu">all_of</span>(context_vars))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>pm <span class="ot">&lt;-</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>  <span class="fu">data.frame</span>( </span>
<span id="cb9-3"><a href="#cb9-3"></a>    <span class="at">id =</span> <span class="fu">colnames</span>(X_full), </span>
<span id="cb9-4"><a href="#cb9-4"></a>    <span class="at">pm =</span> <span class="fu">crossprod</span>(<span class="at">x =</span> X_full, <span class="at">y =</span> rapm_data <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(pts_diff)), </span>
<span id="cb9-5"><a href="#cb9-5"></a>    <span class="at">n_pos =</span> <span class="fu">crossprod</span>(<span class="fu">abs</span>(X_full), <span class="at">y =</span> rapm_data <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(n_pos)), </span>
<span id="cb9-6"><a href="#cb9-6"></a>    <span class="at">minutes =</span> <span class="fu">crossprod</span>(<span class="fu">abs</span>(X_full), <span class="at">y =</span> rapm_data <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(minutes))) <span class="sc">|&gt;</span> </span>
<span id="cb9-7"><a href="#cb9-7"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(<span class="at">y =</span> player_table <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(id, Name), <span class="at">by =</span> <span class="st">"id"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-8"><a href="#cb9-8"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(id, Name, pm, n_pos, minutes) <span class="sc">|&gt;</span> </span>
<span id="cb9-9"><a href="#cb9-9"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(dplyr<span class="sc">::</span><span class="fu">desc</span>(pm))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>                     Name  pm
1 Shai Gilgeous-Alexander 888
2            Jayson Tatum 474
3            Nikola Jokic 452
4   Giannis Antetokounmpo 331
5             Luka Doncic 276
6           Anthony Davis -78
7            LeBron James -88</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="visualizing-plusminus" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-plusminus">Visualizing Plus/Minus</h2>
<div class="cell" data-layout-align="center" data-fit-asp="0.5625">
<div class="sourceCode cell-code" id="annotated-cell-1"><pre class="sourceCode r code-annotation-code code-with-copy"><code class="sourceCode r"><span id="annotated-cell-1-1"><a href="#annotated-cell-1-1" aria-hidden="true" tabindex="-1"></a>oi_colors <span class="ot">&lt;-</span> <span class="fu">palette.colors</span>(<span class="at">palette =</span> <span class="st">"Okabe-Ito"</span>)</span>
<span id="annotated-cell-1-2"><a href="#annotated-cell-1-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(X_full)</span>
<span id="annotated-cell-1-3"><a href="#annotated-cell-1-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(X_full) </span>
<span id="annotated-cell-1-4"><a href="#annotated-cell-1-4" aria-hidden="true" tabindex="-1"></a>y_lim <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">abs</span>(pm<span class="sc">$</span>pm)) <span class="sc">*</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.01</span>, <span class="fl">1.01</span>) </span>
<span id="annotated-cell-1-5"><a href="#annotated-cell-1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-1-6"><a href="#annotated-cell-1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>), <span class="at">mgp =</span> <span class="fu">c</span>(<span class="fl">1.8</span>, <span class="fl">0.5</span>, <span class="dv">0</span>))</span>
<span id="annotated-cell-1-7"><a href="#annotated-cell-1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span>, <span class="at">type =</span> <span class="st">"n"</span>,</span>
<span id="annotated-cell-1-8"><a href="#annotated-cell-1-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, p<span class="sc">+</span><span class="dv">1</span>), <span class="at">ylim =</span> y_lim, </span>
<span id="annotated-cell-1-9"><a href="#annotated-cell-1-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>, </span>
<span id="annotated-cell-1-10"><a href="#annotated-cell-1-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"+/-"</span>, <span class="at">main =</span> <span class="st">"Plus-Minus"</span>) </span>
<span id="annotated-cell-1-11"><a href="#annotated-cell-1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-1-12"><a href="#annotated-cell-1-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>p){</span>
<span id="annotated-cell-1-13"><a href="#annotated-cell-1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="at">x =</span> <span class="fu">c</span>(p<span class="sc">+</span><span class="dv">1</span><span class="sc">-</span>i,p<span class="sc">+</span><span class="dv">1</span><span class="sc">-</span>i), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, pm<span class="sc">$</span>pm[i]), </span>
<span id="annotated-cell-1-14"><a href="#annotated-cell-1-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> oi_colors[<span class="dv">9</span>], <span class="at">lwd =</span> <span class="fl">0.25</span>) </span>
<span id="annotated-cell-1-15"><a href="#annotated-cell-1-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(pm<span class="sc">$</span>Name[i] <span class="sc">%in%</span> selected_players){</span>
<span id="annotated-cell-1-16"><a href="#annotated-cell-1-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(<span class="at">x =</span> p<span class="sc">+</span><span class="dv">1</span><span class="sc">-</span>i, <span class="at">y =</span> pm<span class="sc">$</span>pm[i], <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">cex =</span> <span class="fl">0.7</span>, <span class="at">col =</span> oi_colors[<span class="dv">3</span>])</span>
<span id="annotated-cell-1-17"><a href="#annotated-cell-1-17" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="annotated-cell-1-18"><a href="#annotated-cell-1-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(<span class="at">x =</span> p<span class="sc">+</span><span class="dv">1</span><span class="sc">-</span>i, <span class="at">y =</span> pm<span class="sc">$</span>pm[i], <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">cex =</span> <span class="fl">0.25</span>, <span class="at">col =</span> oi_colors[<span class="dv">9</span>])</span>
<span id="annotated-cell-1-19"><a href="#annotated-cell-1-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="annotated-cell-1-20"><a href="#annotated-cell-1-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="annotated-cell-1-21"><a href="#annotated-cell-1-21" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> oi_colors[<span class="dv">8</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-pm" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="slides_04_files/figure-html/fig-pm-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Figure&nbsp;1: Large gap b/w SGA and rest of the league"><img src="slides_04_files/figure-html/fig-pm-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Large gap b/w SGA and rest of the league
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="plusminus-and-possessions" class="level2">
<h2 class="anchored" data-anchor-id="plusminus-and-possessions">Plus/Minus and Possessions</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>), <span class="at">mgp =</span> <span class="fu">c</span>(<span class="fl">1.8</span>, <span class="fl">0.5</span>, <span class="dv">0</span>))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pm<span class="sc">$</span>n_pos, pm<span class="sc">$</span>pm, </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">cex =</span> <span class="fl">0.5</span>, <span class="at">col =</span> oi_colors[<span class="dv">9</span>],</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Possessions played"</span>, <span class="at">ylab =</span> <span class="st">"+/-"</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Plus-Minus vs Possessions"</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> oi_colors[<span class="dv">8</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-pm-poss" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pm-poss-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="slides_04_files/figure-html/fig-pm-poss-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Figure&nbsp;2: Variability in +/- increases with number of possessions!"><img src="slides_04_files/figure-html/fig-pm-poss-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pm-poss-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Variability in +/- increases with number of possessions!
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="issues-with-plusminus" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="issues-with-plusminus">Issues with Plus/Minus</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>pm <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        id                    Name  pm n_pos minutes
1  1628983 Shai Gilgeous-Alexander 888  8159 2837.31
2  1629652           Luguentz Dort 561  5584 1955.17
3  1630198              Isaiah Joe 552  4896 1715.11
4  1628401           Derrick White 509  6129 2327.72
5  1630596             Evan Mobley 508  5944 2049.43
6  1630598           Aaron Wiggins 507  4868 1683.08
7  1628378        Donovan Mitchell 491  6101 2106.53
8  1628369            Jayson Tatum 474  7498 2840.95
9  1628386           Jarrett Allen 459  6163 2142.82
10  203999            Nikola Jokic 452  7907 2707.97</code></pre>
</div>
</div>
<ul>
<li>Is Lou Dort really better than Jayson Tatum???</li>
</ul>
<p>. . .</p>
<ul>
<li>Differences in +/- could be a result of
<ul>
<li>Differences in skill</li>
<li>Differences in playing time</li>
<li>Differences in teammate &amp; opponent quality</li>
</ul></li>
</ul>
</section>
</section>
<section id="adjusted-plusminus" class="level1">
<h1>Adjusted Plus/Minus</h1>
<section id="from-totals-to-rates" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="from-totals-to-rates">From Totals to Rates</h2>
<ul>
<li>Comparing totals favors players with more playing time</li>
<li>APM works with rates: point differential per 100 possessions</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>rapm_data <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(stint_id, pts_diff, n_pos, margin) <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   stint_id pts_diff n_pos margin
      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
 1        1        6    14   42.9
 2        2        0     5    0  
 3        3       -2     1 -200  
 4        4        8     4  200  
 5        5        2    13   15.4
 6        6        4     8   50  
 7        8        6     9   66.7
 8        9        5    29   17.2
 9       10        0     6    0  
10       11       -2     5  -40  </code></pre>
</div>
</div>
</section>
<section id="an-initial-apm-model" class="level2">
<h2 class="anchored" data-anchor-id="an-initial-apm-model">An Initial APM Model</h2>
<ul>
<li>Associate each player <span class="math inline">\(j\)</span> with a latent strength <span class="math inline">\(\alpha_{j}\)</span></li>
<li><span class="math inline">\(\alpha_{j}\)</span>’s are <strong>unknown</strong>: they must be estimated from data</li>
<li><span class="math inline">\(Y_{i}\)</span>: point differential per 100 possessions in stint <span class="math inline">\(i\)</span></li>
<li><span class="math inline">\(h_{1}(i), \ldots, h_{5}(i)\)</span> &amp; <span class="math inline">\(a_{1}(i), \ldots, a_{5}(i)\)</span>: identities of players on court in stint <span class="math inline">\(i\)</span></li>
</ul>
<p>. . .</p>
<p><span class="math display">\[
\begin{align}
Y_{i} &amp;= \alpha_{0} + \alpha_{h_{1}(i)} + \alpha_{h_{2}(i)} + \alpha_{h_{3}(i)} + \alpha_{h_{4}(i)} + \alpha_{h_{5}(i)} \\
~&amp;~~~~~~~~~~- \alpha_{a_{1}(i)} - \alpha_{a_{2}(i)} - \alpha_{a_{3}(i)} - \alpha_{a_{4}(i)} - \alpha_{a_{5}(i)} + \epsilon_{i},
\end{align}
\]</span></p>
</section>
<section id="interpretation" class="level2">
<h2 class="anchored" data-anchor-id="interpretation">Interpretation</h2>
<ul>
<li>Individual <span class="math inline">\(\alpha_{j}\)</span>’s are meaningless!</li>
<li><span class="math inline">\(\alpha_{j}\)</span>: change in point differential per 100 possessions b/w
<ul>
<li>Playing 5-on-5 w/ player <span class="math inline">\(j\)</span> on the court</li>
<li>Playing 5-on-4 w/ player <span class="math inline">\(j\)</span> off the court</li>
</ul></li>
<li>Differences (or <em>contrasts</em>) like <span class="math inline">\(\alpha_{j}-\alpha_{j'}\)</span> are much more useful</li>
</ul>
</section>
<section id="example" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="example">Example</h2>
<ul>
<li>Dec 23, 2024 game Dallas Mavericks (away) at Golden State Warriors (home):
<ul>
<li>DAL: Luka Doncic, Dereck Lively II, Kyrie Irving, P.J. Washington, and Klay Thompson</li>
<li>GSW: Stephen Curry, Buddy Hield, Andrew Wiggins, Jonathan Kuminga, and Kevon Looney.</li>
</ul></li>
<li>Per 100 possessions, with these lineups DAL expects to outscore GSW by <span class="math display">\[
-1 \times (\alpha_{0} + \alpha_{SC} + \alpha_{BH} + \alpha_{AW} + \alpha_{JK} + \alpha_{KL}) +(\alpha_{LD} + \alpha_{KI} + \alpha_{DL} + \alpha_{PW} + \alpha_{KT}).
\]</span></li>
</ul>
<p>. . .</p>
<ul>
<li>Now imagine that you replaced Doncic w/ Anthony Davis.</li>
<li>Per 100 possessions, DAL expects to outscore GSW by <span class="math display">\[
-1 \times (\alpha_{0} + \alpha_{SC} + \alpha_{BH} + \alpha_{AW} + \alpha_{JK} + \alpha_{KL}) +(\alpha_{AD} + \alpha_{KI} + \alpha_{DL} + \alpha_{PW} + \alpha_{KT}).
\]</span></li>
</ul>
<p>. . .</p>
<ul>
<li>DAL expects to score <span class="math inline">\(\alpha_{\textrm{AD}} - \alpha_{\textrm{LD}}\)</span> more points per 100 possessions with Davis than Doncic, <strong>all else being equal</strong></li>
</ul>
</section>
<section id="apm-as-a-linear-model" class="level2">
<h2 class="anchored" data-anchor-id="apm-as-a-linear-model">APM As A Linear Model</h2>
<ul>
<li>Append a column of 1’s to <span class="math inline">\(\boldsymbol{\mathbf{X}}\)</span> to form <span class="math inline">\(n \times (p+1)\)</span> matrix <span class="math inline">\(\boldsymbol{\mathbf{Z}}\)</span></li>
<li>Let <span class="math inline">\(\boldsymbol{\mathbf{z}}_{i}\)</span> be the <span class="math inline">\(i\)</span>-th row of <span class="math inline">\(\boldsymbol{\mathbf{Z}}\)</span></li>
<li>APM asserts: <span class="math inline">\(Y_{i} = \boldsymbol{\mathbf{z}}_{i}^{\top}\boldsymbol{\alpha} + \epsilon_{i}.\)</span></li>
</ul>
<p>. . .</p>
<ul>
<li>Tempting to estimate <span class="math inline">\(\boldsymbol{\alpha}\)</span> with least squares <span class="math display">\[
\textrm{argmin} \sum_{i = 1}^{n}{\left( Y_{i} - \boldsymbol{\mathbf{z}}_{i}^{\top}\boldsymbol{\alpha} \right)^{2}} .
\]</span></li>
</ul>
</section>
<section id="singularity" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="singularity">Singularity</h2>
<ul>
<li>Least squares problem does not have a unique solution!</li>
<li>Columns of <span class="math inline">\(\boldsymbol{\mathbf{Z}}\)</span> are linearly dependent
<ul>
<li>The first element in each row is equal to 1 (for intercept)</li>
<li>5 entries equal to 1 (for home players)</li>
<li>5 entries equal to -1 (for away players)</li>
</ul></li>
<li>If you know all but one column, you can perfectly determine that column</li>
<li><span class="math inline">\(\boldsymbol{\mathbf{Z}}^{\top}\boldsymbol{\mathbf{Z}}\)</span> not invertible</li>
</ul>
</section>
<section id="non-identifiability" class="level2">
<h2 class="anchored" data-anchor-id="non-identifiability">Non-identifiability</h2>
<ul>
<li>Recall that the model asserts <span class="math display">\[
\begin{align}
Y_{i} &amp;= \alpha_{0} + \alpha_{h_{1}(i)} + \alpha_{h_{2}(i)} + \alpha_{h_{3}(i)} + \alpha_{h_{4}(i)} + \alpha_{h_{5}(i)} \\
~&amp;~~~~~~~~~~- \alpha_{a_{1}(i)} - \alpha_{a_{2}(i)} - \alpha_{a_{3}(i)} - \alpha_{a_{4}(i)} - \alpha_{a_{5}(i)} + \epsilon_{i},
\end{align}
\]</span></li>
<li>Imagine we add 5 to every <span class="math inline">\(\alpha_{j}\)</span>: right-hand side remains unchanged</li>
<li>So, we can’t hope to learn <span class="math inline">\(\alpha_{j}\)</span>’s exactly!</li>
</ul>
</section>
<section id="baseline-contrasts" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="baseline-contrasts">Baseline Contrasts</h2>
<ul>
<li>Classify certain players as “baseline”-level (e.g., <span class="math inline">\(&lt; 250\)</span> minutes)</li>
<li>Re-number players so first <span class="math inline">\(p'\)</span> are non-baseline</li>
<li><strong>Assumption</strong>: <span class="math inline">\(\alpha_{j} = \mu\)</span> for all baseline players <span class="math inline">\(j &gt; p'\)</span>
<ul>
<li>All baseline players <strong>assumed</strong> to have the same underlying skill</li>
</ul></li>
</ul>
<p>. . .</p>
<ul>
<li>For non-baseline <span class="math inline">\(j = 1, \ldots, p,\)</span> let <span class="math inline">\(\beta_{j} = \alpha_{j} - \mu\)</span></li>
<li><span class="math inline">\(\beta_{j}\)</span>: effect of replacing player <span class="math inline">\(j\)</span> <em>with a baseline player</em></li>
</ul>
</section>
<section id="a-re-parametrized-model" class="level2">
<h2 class="anchored" data-anchor-id="a-re-parametrized-model">A Re-parametrized Model</h2>
<ul>
<li><span class="math inline">\(\tilde{\boldsymbol{\mathbf{Z}}}\)</span> be the <span class="math inline">\(n \times (p'+1)\)</span> submatrix of <span class="math inline">\(\boldsymbol{\mathbf{Z}}\)</span> s.t.
<ul>
<li>First column is all 1’s</li>
<li>Remaining columns: signed on-court indicators for non-baseline players</li>
</ul></li>
<li>Turns out:
<ul>
<li><span class="math inline">\(\tilde{\boldsymbol{\mathbf{Z}}}\boldsymbol{\beta} = \boldsymbol{\mathbf{Z}}\boldsymbol{\alpha}\)</span></li>
<li><span class="math inline">\(\tilde{\boldsymbol{\mathbf{Z}}}\)</span></li>
<li>Can minimize <span class="math inline">\(\sum_{i = 1}^{n}{\left(Y_{i} - \tilde{\boldsymbol{\mathbf{z}}}_{i}^{\top}\boldsymbol{\beta}\right)^{2}}\)</span></li>
</ul></li>
</ul>
<p><span class="math display">\[
\hat{\boldsymbol{\beta}} = \left( \tilde{\boldsymbol{\mathbf{Z}}}^{\top}\tilde{\boldsymbol{\mathbf{Z}}}\right)^{-1}\tilde{\boldsymbol{\mathbf{Z}}}^{\top}\boldsymbol{\mathbf{Y}}.
\]</span></p>
</section>
<section id="estimating-boldsymbolbeta" class="level2">
<h2 class="anchored" data-anchor-id="estimating-boldsymbolbeta">Estimating <span class="math inline">\(\boldsymbol{\beta}\)</span></h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">Defining Baselines</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Estimating <span class="math inline">\(\boldsymbol{\beta}\)</span></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-3" role="tab" aria-controls="tabset-4-3" aria-selected="false">Top-10 APM’s</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>nonbaseline_id <span class="ot">&lt;-</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  pm <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(minutes <span class="sc">&gt;=</span> <span class="dv">250</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-19"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy"><code class="sourceCode r"><span id="annotated-cell-19-1"><a href="#annotated-cell-19-1"></a>apm_df <span class="ot">&lt;-</span></span>
<span id="annotated-cell-19-2"><a href="#annotated-cell-19-2"></a>  rapm_data <span class="sc">|&gt;</span></span>
<span id="annotated-cell-19-3"><a href="#annotated-cell-19-3"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(tidyr<span class="sc">::</span><span class="fu">all_of</span>(<span class="fu">c</span>(<span class="st">"margin"</span>, nonbaseline_id)))</span>
<span id="annotated-cell-19-4"><a href="#annotated-cell-19-4"></a>apm_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(margin <span class="sc">~</span> ., <span class="at">data =</span> apm_df)</span>
<span id="annotated-cell-19-5"><a href="#annotated-cell-19-5"></a>beta0 <span class="ot">&lt;-</span> <span class="fu">coefficients</span>(apm_fit)[<span class="dv">1</span>]</span>
<span id="annotated-cell-19-6"><a href="#annotated-cell-19-6"></a>beta <span class="ot">&lt;-</span> <span class="fu">coefficients</span>(apm_fit)[<span class="sc">-</span><span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-4-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-3-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>                    Name      apm
1          Tobias Harris 17.01331
2         Mouhamed Gueye 16.79320
3           Devin Carter 16.60148
4             Trae Young 15.13287
5  Giannis Antetokounmpo 14.61082
6            Isaiah Wong 14.50091
7           Nikola Jokic 14.40837
8         Alperen Sengun 13.55544
9        Quenton Jackson 13.13962
10    Karl-Anthony Towns 13.13714</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="weighted-adjusted-plusminus" class="level1">
<h1>Weighted Adjusted Plus/Minus</h1>
<section id="missing-context" class="level2">
<h2 class="anchored" data-anchor-id="missing-context">Missing Context</h2>
<ul>
<li>APM does not account for context &gt; “can artificially can artificially inflate the importance of performance in low-leverage situations, when the outcome of the game is essentially decided, while simultaneously deflating the importance of high-leverage performance, when the final outcome is still in question. For instance, point diﬀerential-based metrics model the home team’s lead dropping from 5 points to 0 points in the last minute of the first half in exactly the same way that they model the home team’s lead dropping from 30 points to 25 points in the last minute of the second half”.</li>
</ul>
</section>
<section id="a-weighted-version-of-apm" class="level2">
<h2 class="anchored" data-anchor-id="a-weighted-version-of-apm">A Weighted Version of APM</h2>
<ul>
<li>Introduce weight <span class="math inline">\(w_{i}\)</span> for stint <span class="math inline">\(i\)</span></li>
<li>Find <span class="math inline">\(\tilde{\boldsymbol{\beta}}\)</span> minimizing <span class="math inline">\(w_{i}\left(Y_{i} - \tilde{\boldsymbol{\mathbf{z}}}_{i}^{\top}\boldsymbol{\beta}\right)^{2}\)</span></li>
<li>Solution: <span class="math inline">\(\boldsymbol{\mathbf{W}}\)</span> diagonal matrix w/ entries <span class="math inline">\(w_{i}\)</span> <span class="math display">\[
\hat{\boldsymbol{\beta}}_{w} = \left( \tilde{\boldsymbol{\mathbf{Z}}}^{\top}\tilde{\boldsymbol{\mathbf{Z}}}\right)^{-1}\tilde{\boldsymbol{\mathbf{Z}}}^{\top}\boldsymbol{\mathbf{W}}\boldsymbol{\mathbf{Y}}
\]</span></li>
</ul>
</section>
<section id="estimating-wapm" class="level2">
<h2 class="anchored" data-anchor-id="estimating-wapm">Estimating wAPM</h2>
<ul>
<li>Example weights:
<ul>
<li><span class="math inline">\(w_{i} = 1\)</span> if lead <span class="math inline">\(&lt; 10\)</span></li>
<li><span class="math inline">\(w_{i} = 0\)</span> if one team leads by <span class="math inline">\(&gt; 30\)</span> at start of <span class="math inline">\(i\)</span></li>
<li><span class="math inline">\(w_{i} = 1 - (\textrm{StartDiff} - 10)/20\)</span>: if <span class="math inline">\(10 \leq \textrm{lead} \leq 30\)</span></li>
</ul></li>
</ul>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">Defining Weights</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Fit wAPM</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-3" role="tab" aria-controls="tabset-5-3" aria-selected="false">Top-10 wAPM</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>wapm_df <span class="ot">&lt;-</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  rapm_data <span class="sc">|&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">start_diff =</span> <span class="fu">abs</span>(start_home_score <span class="sc">-</span> start_away_score), </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">w =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>      start_diff <span class="sc">&lt;</span> <span class="dv">10</span> <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>      start_diff <span class="sc">&gt;</span> <span class="dv">30</span> <span class="sc">~</span> <span class="dv">0</span>, </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> <span class="dv">1</span> <span class="sc">-</span> (start_diff<span class="dv">-10</span>)<span class="sc">/</span><span class="dv">20</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(tidyr<span class="sc">::</span><span class="fu">all_of</span>(<span class="fu">c</span>(<span class="st">"margin"</span>, <span class="st">"w"</span>, nonbaseline_id)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>wapm_fit <span class="ot">&lt;-</span> </span>
<span id="cb19-2"><a href="#cb19-2"></a>  <span class="fu">lm</span>(<span class="at">formula =</span> margin <span class="sc">~</span> . <span class="sc">-</span> w, </span>
<span id="cb19-3"><a href="#cb19-3"></a>     <span class="at">weights =</span> w, </span>
<span id="cb19-4"><a href="#cb19-4"></a>     <span class="at">data =</span> wapm_df) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-5-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-3-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>                Name     wapm
1       Devin Carter 19.48318
2      Tobias Harris 17.11044
3    Lauri Markkanen 15.20344
4     Mouhamed Gueye 14.76474
5         Trae Young 14.52393
6       Nikola Jokic 14.14573
7     Alperen Sengun 14.03023
8         OG Anunoby 13.96219
9  Jordan McLaughlin 13.73760
10      Jericho Sims 13.27850</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="looking-ahead" class="level2">
<h2 class="anchored" data-anchor-id="looking-ahead">Looking Ahead</h2>
<ul>
<li>(w)APM is quite sensitive to certain choices:
<ul>
<li>Definition of baseline players</li>
<li>Choice of weights</li>
</ul></li>
<li>Constant baseline skill assumption is highly unsatisfactory</li>
<li>Issues due to inability to use least squares</li>
<li>Next time: alternative estimation strategy
<ul>
<li>Avoids having to specify baseline players</li>
<li>Estimates a latent strength for <em>all</em> players</li>
</ul></li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
        for (let i=0; i<annoteTargets.length; i++) {
          const annoteTarget = annoteTargets[i];
          const targetCell = annoteTarget.getAttribute("data-target-cell");
          const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
          const contentFn = () => {
            const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
            if (content) {
              const tipContent = content.cloneNode(true);
              tipContent.classList.add("code-annotation-tip-content");
              return tipContent.outerHTML;
            }
          }
          const config = {
            allowHTML: true,
            content: contentFn,
            onShow: (instance) => {
              selectCodeLines(instance.reference);
              instance.reference.classList.add('code-annotation-active');
              window.tippy.hideAll();
            },
            onHide: (instance) => {
              unselectCodeLines();
              instance.reference.classList.remove('code-annotation-active');
            },
            maxWidth: 300,
            delay: [50, 0],
            duration: [200, 0],
            offset: [5, 10],
            arrow: true,
            appendTo: function(el) {
              return el.parentElement.parentElement.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'quarto',
            placement: 'right',
            popperOptions: {
              modifiers: [
              {
                name: 'flip',
                options: {
                  flipVariations: false, // true by default
                  allowedAutoPlacements: ['right'],
                  fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
                },
              },
              {
                name: 'preventOverflow',
                options: {
                  mainAxis: false,
                  altAxis: false
                }
              }
              ]        
            }      
          };
          window.tippy(annoteTarget, config); 
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>