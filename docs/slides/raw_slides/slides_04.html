<!DOCTYPE html>
<html lang="en"><head>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.7.32">

  <title>STAT479 – STAT 479: Lecture 4</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/theme/quarto-9a1a2c3d5c7ea7f04258c8f180195b78.css">
  <link href="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">STAT 479: Lecture 4</h1>
  <p class="subtitle">Adjusted Plus/Minus</p>

<div class="quarto-title-authors">
</div>

</section>
<section id="motivation" class="slide level2 smaller">
<h2>Motivation</h2>
<ul>
<li>How do NBA players help their teams win?</li>
<li>How do we quantify contributions?</li>
</ul>
<div class="fragment">
<ul>
<li>Idea: good players do things that show up in the box score
<ul>
<li>Points, rebounds, assists, steals, blocks, turnovers</li>
<li>Easy to collect, sort, explain</li>
</ul></li>
</ul>
<p>. . . - Fails to account for roles - 10 assists for a guard vs 10 rebounds by a center - Problem: should some stats weigh more heavily than others?</p>
</div>
<div class="fragment">
<ul>
<li>Bigger problem: Not everything appears in the box score
<ul>
<li>Setting screens, rotating on defense, communicating</li>
<li>Good shot selection, diving for loose balls</li>
<li>The “little things”</li>
</ul></li>
</ul>
</div>
</section>
<section id="plusminus" class="slide level2">
<h2>Plus/Minus</h2>
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Definition: Plus/Minus</strong></p>
</div>
<div class="callout-content">
<p>A player’s <strong>plus/minus</strong> is the point differential that a player’s team accrues while they are on the court.</p>
</div>
</div>
</div>
<ul>
<li><p>Intuition: if your team outscores opponent while you’re on the court, you must be doing something right</p></li>
<li><p>To compute, must know who is on the court at all times</p></li>
</ul>
</section>
<section id="play-by-play-nba-data" class="slide level2 smaller">
<h2>Play-by-Play NBA Data</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="nba_pbp_screenshot.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img data-src="nba_pbp_screenshot.png" class="quarto-figure quarto-figure-center" style="width:60.0%"></a></p>
</figure>
</div>
<ul>
<li>Entry created when player does something tracked by scorekeeper</li>
<li>Can use the <strong>hoopR</strong> package to scrape play-by-play data into R</li>
</ul>
</section>
<section id="stint-level-data" class="slide level2 smaller">
<h2>Stint-Level Data</h2>
<ul>
<li><p>Stint: period of play b/w substitutions where the same 10 players remain on the court.</p></li>
<li><p>Can form a data table from play-by-play log where</p>
<ul>
<li>Rows correspond to stints</li>
<li>Columns for game context: start &amp; end scores, length in minutes, etc.</li>
<li>Column for every player’s <em>signed on-court indicator</em></li>
</ul></li>
<li><p>Signed on-court indicators:</p>
<ul>
<li>+1 if on-court and playing at home</li>
<li>-1 if on-court and playing on the road</li>
<li>0 if not on court</li>
</ul></li>
</ul>
</section>
<section id="data-snapshot" class="slide level2 smaller">
<h2>Data Snapshot</h2>
<ul>
<li>Context columns:
<ul>
<li>Game &amp; Stint ID; num. possessions; duration;</li>
<li>Start &amp; end scores &amp; times; point differential</li>
</ul></li>
<li>569 columns of signed on-court indicators</li>
</ul>
<div class="panel-tabset">
<ul id="tabset-1" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-1-1">Context</a></li><li><a href="#tabset-1-2">On-Court Indicators</a></li><li><a href="#tabset-1-3">Player IDs</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 7
  stint_id n_pos start_minutes minutes home_points away_points pts_diff
     &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;    &lt;dbl&gt;
1        1    14          0      5.42           18          12        6
2        2     5          5.42   1.51            2           2        0
3        3     1          6.93   0.220           0           2       -2
4        4     4          7.15   2.17            9           1        8
5        5    13          9.32   4.13           13          11        2</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 7
  stint_id `201143` `201950` `1627759` `1628369` `1628436` `1630202`
     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1        1        1        1         1         1         0         0
2        2        1        0         0         1         1         1
3        3        1        0         0         1         1         1
4        4        0        0         0         1         1         1
5        5        0        1         0         1         1         1</code></pre>
</div>
</div>
</div>
<div id="tabset-1-3">
<div class="cell">
<div class="sourceCode cell-code" id="cb3" data-code-line-numbers="|6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a></a>player_table <span class="ot">&lt;-</span></span>
<span id="cb3-2"><a></a>  hoopR<span class="sc">::</span><span class="fu">nba_commonallplayers</span>()[[<span class="st">"CommonAllPlayers"</span>]] <span class="sc">|&gt;</span></span>
<span id="cb3-3"><a></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(PERSON_ID, DISPLAY_FIRST_LAST) <span class="sc">|&gt;</span></span>
<span id="cb3-4"><a></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">id =</span> PERSON_ID, <span class="at">FullName =</span> DISPLAY_FIRST_LAST) <span class="sc">|&gt;</span></span>
<span id="cb3-5"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb3-6"><a></a>    <span class="at">Name =</span> stringi<span class="sc">::</span><span class="fu">stri_trans_general</span>(FullName, <span class="st">"Latin-ASCII"</span>)) </span>
<span id="cb3-7"><a></a></span>
<span id="cb3-8"><a></a>player_table <span class="sc">|&gt;</span></span>
<span id="cb3-9"><a></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"201143"</span>, <span class="st">"201950"</span>, <span class="st">"1627759"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb3-10"><a></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(FullName)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Jaylen Brown" "Jrue Holiday" "Al Horford"  </code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section>
<section id="plusminus-1" class="title-slide slide level1 center">
<h1>Plus/Minus</h1>

</section>
<section id="computing-individual---concept" class="slide level2">
<h2>Computing Individual +/- (Concept)</h2>
<ul>
<li><p>Consider Shai Gilgeous-Alexander (2024-25 MVP)</p></li>
<li><p>To compute SGA’s +/-:</p>
<ol type="1">
<li>Sum the home team point differentials for all stints where SGA was on the court and playing at home.</li>
<li>Sum the <em>negative</em> of the home team point differentials for all shifts where SGA was on the court and playing on the road.</li>
<li>Add the two totals from Steps 1 and 2.</li>
</ol></li>
</ul>
</section>
<section id="computing-individual---formula" class="slide level2">
<h2>Computing Individual +/- (Formula)</h2>
<ul>
<li><span class="math inline">\(\Delta_{i}\)</span>: home team point differential in shift <span class="math inline">\(i\)</span></li>
<li><span class="math inline">\(x_{i, \textrm{SGA}}\)</span>: SGA’s signed on-court indicator:
<ul>
<li><span class="math inline">\(x_{i, \textrm{SGA}} = 0\)</span> if SGA off-court in stint <span class="math inline">\(i\)</span></li>
<li><span class="math inline">\(x_{i, \textrm{SGA}} = 1(-1)\)</span> if SGA on-court at home (away) in stint <span class="math inline">\(i\)</span></li>
</ul></li>
<li>SGA’s +/- is just <span class="math display">\[
\sum_{i = 1}^{n}{x_{i,\textrm{SGA}} \times \Delta_{i}}.
\]</span></li>
</ul>
</section>
<section id="computing-individual---code" class="slide level2">
<h2>Computing Individual +/- (Code)</h2>
<ul>
<li>When SGA was on the floor, Thunder outscored opponents by 888 pts</li>
<li>When Jokic was on the floor, Nuggets outscored opponents by 452</li>
</ul>
<div class="panel-tabset">
<ul id="tabset-2" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-2-1">SGA</a></li><li><a href="#tabset-2-2">Jokic</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb5" data-code-line-numbers="|1-2|3-4|5|"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a></a>shai_id <span class="ot">&lt;-</span> player_table <span class="sc">|&gt;</span></span>
<span id="cb5-2"><a></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Name <span class="sc">==</span> <span class="st">"Shai Gilgeous-Alexander"</span>) <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(id) </span>
<span id="cb5-3"><a></a>shai_x <span class="ot">&lt;-</span> rapm_data <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(shai_id) </span>
<span id="cb5-4"><a></a>delta <span class="ot">&lt;-</span> rapm_data <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(pts_diff) </span>
<span id="cb5-5"><a></a><span class="fu">sum</span>(shai_x <span class="sc">*</span> delta)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 888</code></pre>
</div>
</div>
</div>
</div>
<div id="tabset-2-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a></a>jokic_id <span class="ot">&lt;-</span></span>
<span id="cb7-2"><a></a>  player_table <span class="sc">|&gt;</span></span>
<span id="cb7-3"><a></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Name <span class="sc">==</span> <span class="st">"Nikola Jokic"</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-4"><a></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(id)</span>
<span id="cb7-5"><a></a></span>
<span id="cb7-6"><a></a>jokic_x <span class="ot">&lt;-</span> rapm_data <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(jokic_id) </span>
<span id="cb7-7"><a></a><span class="fu">sum</span>(jokic_x <span class="sc">*</span> delta) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 452</code></pre>
</div>
</div>
</div>
</div>
</div>
</section></section>
<section>
<section id="digression-matrix-computation" class="title-slide slide level1 center">
<h1>Digression: Matrix Computation</h1>

</section>
<section id="notation" class="slide level2 smaller">
<h2>Notation</h2>
<ul>
<li><p><span class="math inline">\(n\)</span>: total number of stints in the season</p></li>
<li><p><span class="math inline">\(p\)</span>: total number of players</p></li>
<li><p>For each stint <span class="math inline">\(i = 1, \ldots, n\)</span> and player <span class="math inline">\(j = 1, \ldots, p\)</span>:</p>
<ul>
<li><span class="math inline">\(x_{ij} = 1\)</span> if player <span class="math inline">\(j\)</span> on-court at home in stint <span class="math inline">\(i\)</span></li>
<li><span class="math inline">\(x_{ij} = -1\)</span> if player <span class="math inline">\(j\)</span> on-court on road in stint <span class="math inline">\(i\)</span></li>
<li><span class="math inline">\(x_{ij} = 0\)</span></li>
</ul></li>
<li><p><span class="math inline">\(\Delta_{i}\)</span>: home-team differential in stint <span class="math inline">\(i\)</span> . . .</p></li>
<li><p>Player <span class="math inline">\(j\)</span>’s +/-: <span class="math inline">\(\sum_{i}{x_{ij}\Delta_{i}}\)</span></p></li>
</ul>
</section>
<section id="stint-design-matrix" class="slide level2 smaller">
<h2>Stint Design Matrix</h2>
<ul>
<li>Arrange <span class="math inline">\(x_{ij}\)</span>’s into an <span class="math inline">\(n \times p\)</span> matrix</li>
</ul>
<p><span class="math display">\[
\boldsymbol{\mathbf{X}} =
\begin{pmatrix}
x_{1,1} &amp; \cdots &amp; x_{1,p} \\
\vdots &amp; &amp; \vdots \\
x_{n,1} &amp; \cdots &amp; x_{n,p}
\end{pmatrix}
\]</span></p>
<div class="fragment">
<ul>
<li>Collect all <span class="math inline">\(n\)</span> <span class="math inline">\(\Delta_{i}\)</span>’s into a vector of length <span class="math inline">\(n\)</span> <span class="math display">\[
\boldsymbol{\Delta} = \begin{pmatrix} \Delta_{1} \\ \vdots \\ \Delta_{n} \end{pmatrix}
\]</span></li>
</ul>
</div>
</section>
<section id="computing-all--s" class="slide level2">
<h2>Computing all +/-’s</h2>
<ul>
<li>Can compute <strong>all</strong> player’s w/ matrix-vector multiplication <span class="math inline">\(\boldsymbol{\mathbf{X}}^{\top}\boldsymbol{\Delta}\)</span> <span class="math display">\[
\begin{pmatrix}
x_{1,1} &amp; \cdots &amp; x_{n,1} \\
\vdots &amp; &amp; \vdots \\
x_{1,p} &amp; \cdots &amp; x_{n,p}
\end{pmatrix}
\begin{pmatrix} \Delta_{1} \\ \vdots \\ \Delta_{n} \end{pmatrix}
=
\begin{pmatrix}
x_{1,1}\Delta_{1} + x_{2,1}\Delta_{2} + \cdots + x_{n,1}\Delta_{n}\\
\vdots \\
x_{1,p}\Delta_{1} + x_{2,p}\Delta_{2} + \cdots + x_{n,p}\Delta_{n}
\end{pmatrix}
\]</span></li>
</ul>
</section>
<section id="computing-plusminus" class="slide level2">
<h2>Computing Plus/Minus</h2>
<div class="panel-tabset">
<ul id="tabset-3" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-3-1">Building <span class="math inline">\(\boldsymbol{\mathbf{X}}\)</span></a></li><li><a href="#tabset-3-2">Computing Plus/Minus</a></li><li><a href="#tabset-3-3">Selected Players</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1">
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-10"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy"><code class="sourceCode r"><span id="annotated-cell-10-1"><a href="#annotated-cell-10-1"></a>context_vars <span class="ot">&lt;-</span></span>
<span id="annotated-cell-10-2"><a href="#annotated-cell-10-2"></a>  <span class="fu">c</span>(<span class="st">"game_id"</span>, <span class="st">"stint_id"</span>, <span class="st">"n_pos"</span>, </span>
<span id="annotated-cell-10-3"><a href="#annotated-cell-10-3"></a>    <span class="st">"start_home_score"</span>, <span class="st">"start_away_score"</span>, <span class="st">"start_minutes"</span>,</span>
<span id="annotated-cell-10-4"><a href="#annotated-cell-10-4"></a>    <span class="st">"end_home_score"</span>, <span class="st">"end_away_score"</span>, <span class="st">"end_minutes"</span>,</span>
<span id="annotated-cell-10-5"><a href="#annotated-cell-10-5"></a>    <span class="st">"home_points"</span>, <span class="st">"away_points"</span>, <span class="st">"minutes"</span>,</span>
<span id="annotated-cell-10-6"><a href="#annotated-cell-10-6"></a>    <span class="st">"pts_diff"</span>, <span class="st">"margin"</span>)</span>
<span id="annotated-cell-10-7"><a href="#annotated-cell-10-7"></a></span>
<span id="annotated-cell-10-8"><a href="#annotated-cell-10-8"></a>X_full <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>( </span>
<span id="annotated-cell-10-9"><a href="#annotated-cell-10-9"></a>    rapm_data <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span> tidyr<span class="sc">::</span><span class="fu">all_of</span>(context_vars))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb9" data-code-line-numbers="|4|5-6|1-2|7-9|"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a></a>pm <span class="ot">&lt;-</span></span>
<span id="cb9-2"><a></a>  <span class="fu">data.frame</span>( </span>
<span id="cb9-3"><a></a>    <span class="at">id =</span> <span class="fu">colnames</span>(X_full), </span>
<span id="cb9-4"><a></a>    <span class="at">pm =</span> <span class="fu">crossprod</span>(<span class="at">x =</span> X_full, <span class="at">y =</span> rapm_data <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(pts_diff)), </span>
<span id="cb9-5"><a></a>    <span class="at">n_pos =</span> <span class="fu">crossprod</span>(<span class="fu">abs</span>(X_full), <span class="at">y =</span> rapm_data <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(n_pos)), </span>
<span id="cb9-6"><a></a>    <span class="at">minutes =</span> <span class="fu">crossprod</span>(<span class="fu">abs</span>(X_full), <span class="at">y =</span> rapm_data <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(minutes))) <span class="sc">|&gt;</span> </span>
<span id="cb9-7"><a></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(<span class="at">y =</span> player_table <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(id, Name), <span class="at">by =</span> <span class="st">"id"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-8"><a></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(id, Name, pm, n_pos, minutes) <span class="sc">|&gt;</span> </span>
<span id="cb9-9"><a></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(dplyr<span class="sc">::</span><span class="fu">desc</span>(pm))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-3">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>                     Name  pm
1 Shai Gilgeous-Alexander 888
2            Jayson Tatum 474
3            Nikola Jokic 452
4   Giannis Antetokounmpo 331
5             Luka Doncic 276
6           Anthony Davis -78
7            LeBron James -88</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="visualizing-plusminus" class="slide level2">
<h2>Visualizing Plus/Minus</h2>
<div class="cell" data-layout-align="center" data-fit-asp="0.5625">
<div class="cell-output-display">
<div id="fig-pm" class="quarto-float quarto-figure quarto-figure-center" data-fig-align="center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-pm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="slides_04_files/figure-revealjs/fig-pm-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Figure&nbsp;1: Large gap b/w SGA and rest of the league"><img data-src="slides_04_files/figure-revealjs/fig-pm-1.png" class="quarto-figure quarto-figure-center" width="768"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Large gap b/w SGA and rest of the league
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="plusminus-and-possessions" class="slide level2">
<h2>Plus/Minus and Possessions</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-pm-poss" class="quarto-float quarto-figure quarto-figure-center" data-fig-align="center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-pm-poss-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="slides_04_files/figure-revealjs/fig-pm-poss-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Figure&nbsp;2: Variability in +/- increases with number of possessions!"><img data-src="slides_04_files/figure-revealjs/fig-pm-poss-1.png" class="quarto-figure quarto-figure-center" width="576"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pm-poss-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Variability in +/- increases with number of possessions!
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="issues-with-plusminus" class="slide level2 smaller">
<h2>Issues with Plus/Minus</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a></a>pm <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        id                    Name  pm n_pos minutes
1  1628983 Shai Gilgeous-Alexander 888  8159 2837.31
2  1629652           Luguentz Dort 561  5584 1955.17
3  1630198              Isaiah Joe 552  4896 1715.11
4  1628401           Derrick White 509  6129 2327.72
5  1630596             Evan Mobley 508  5944 2049.43
6  1630598           Aaron Wiggins 507  4868 1683.08
7  1628378        Donovan Mitchell 491  6101 2106.53
8  1628369            Jayson Tatum 474  7498 2840.95
9  1628386           Jarrett Allen 459  6163 2142.82
10  203999            Nikola Jokic 452  7907 2707.97</code></pre>
</div>
</div>
<ul>
<li>Is Lou Dort really better than Jayson Tatum???</li>
</ul>
<div class="fragment">
<ul>
<li>Differences in +/- could be a result of
<ul>
<li>Differences in skill</li>
<li>Differences in playing time</li>
<li>Differences in teammate &amp; opponent quality</li>
</ul></li>
</ul>
</div>
</section></section>
<section>
<section id="adjusted-plusminus" class="title-slide slide level1 center">
<h1>Adjusted Plus/Minus</h1>

</section>
<section id="from-totals-to-rates" class="slide level2 smaller">
<h2>From Totals to Rates</h2>
<ul>
<li>Comparing totals favors players with more playing time</li>
<li>APM works with rates: point differential per 100 possessions</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   stint_id pts_diff n_pos margin
      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
 1        1        6    14   42.9
 2        2        0     5    0  
 3        3       -2     1 -200  
 4        4        8     4  200  
 5        5        2    13   15.4
 6        6        4     8   50  
 7        8        6     9   66.7
 8        9        5    29   17.2
 9       10        0     6    0  
10       11       -2     5  -40  </code></pre>
</div>
</div>
</section>
<section id="an-initial-apm-model" class="slide level2">
<h2>An Initial APM Model</h2>
<ul>
<li>Associate each player <span class="math inline">\(j\)</span> with a latent strength <span class="math inline">\(\alpha_{j}\)</span></li>
<li><span class="math inline">\(\alpha_{j}\)</span>’s are <strong>unknown</strong>: they must be estimated from data</li>
<li><span class="math inline">\(Y_{i}\)</span>: point differential per 100 possessions in stint <span class="math inline">\(i\)</span></li>
<li><span class="math inline">\(h_{1}(i), \ldots, h_{5}(i)\)</span> &amp; <span class="math inline">\(a_{1}(i), \ldots, a_{5}(i)\)</span>: identities of players on court in stint <span class="math inline">\(i\)</span></li>
</ul>
<div class="fragment">
<p><span class="math display">\[
\begin{align}
Y_{i} &amp;= \alpha_{0} + \alpha_{h_{1}(i)} + \alpha_{h_{2}(i)} + \alpha_{h_{3}(i)} + \alpha_{h_{4}(i)} + \alpha_{h_{5}(i)} \\
~&amp;~~~~~~~~~~- \alpha_{a_{1}(i)} - \alpha_{a_{2}(i)} - \alpha_{a_{3}(i)} - \alpha_{a_{4}(i)} - \alpha_{a_{5}(i)} + \epsilon_{i},
\end{align}
\]</span></p>
</div>
</section>
<section id="interpretation" class="slide level2">
<h2>Interpretation</h2>
<ul>
<li>Individual <span class="math inline">\(\alpha_{j}\)</span>’s are meaningless!</li>
<li><span class="math inline">\(\alpha_{j}\)</span>: change in point differential per 100 possessions b/w
<ul>
<li>Playing 5-on-5 w/ player <span class="math inline">\(j\)</span> on the court</li>
<li>Playing 5-on-4 w/ player <span class="math inline">\(j\)</span> off the court</li>
</ul></li>
<li>Differences (or <em>contrasts</em>) like <span class="math inline">\(\alpha_{j}-\alpha_{j'}\)</span> are much more useful</li>
</ul>
</section>
<section id="example" class="slide level2 smaller">
<h2>Example</h2>
<ul>
<li>Dec 23, 2024 game Dallas Mavericks (away) at Golden State Warriors (home):
<ul>
<li>DAL: Luka Doncic, Dereck Lively II, Kyrie Irving, P.J. Washington, and Klay Thompson</li>
<li>GSW: Stephen Curry, Buddy Hield, Andrew Wiggins, Jonathan Kuminga, and Kevon Looney.</li>
</ul></li>
<li>Per 100 possessions, with these lineups DAL expects to outscore GSW by <span class="math display">\[
-1 \times (\alpha_{0} + \alpha_{SC} + \alpha_{BH} + \alpha_{AW} + \alpha_{JK} + \alpha_{KL}) +(\alpha_{LD} + \alpha_{KI} + \alpha_{DL} + \alpha_{PW} + \alpha_{KT}).
\]</span></li>
</ul>
<div class="fragment">
<ul>
<li>Now imagine that you replaced Doncic w/ Anthony Davis.</li>
<li>Per 100 possessions, DAL expects to outscore GSW by <span class="math display">\[
-1 \times (\alpha_{0} + \alpha_{SC} + \alpha_{BH} + \alpha_{AW} + \alpha_{JK} + \alpha_{KL}) +(\alpha_{AD} + \alpha_{KI} + \alpha_{DL} + \alpha_{PW} + \alpha_{KT}).
\]</span></li>
</ul>
</div>
<div class="fragment">
<ul>
<li>DAL expects to score <span class="math inline">\(\alpha_{\textrm{AD}} - \alpha_{\textrm{LD}}\)</span> more points per 100 possessions with Davis than Doncic, <strong>all else being equal</strong></li>
</ul>
</div>
</section>
<section id="apm-as-a-linear-model" class="slide level2">
<h2>APM As A Linear Model</h2>
<ul>
<li>Append a column of 1’s to <span class="math inline">\(\boldsymbol{\mathbf{X}}\)</span> to form <span class="math inline">\(n \times (p+1)\)</span> matrix <span class="math inline">\(\boldsymbol{\mathbf{Z}}\)</span></li>
<li>Let <span class="math inline">\(\boldsymbol{\mathbf{z}}_{i}\)</span> be the <span class="math inline">\(i\)</span>-th row of <span class="math inline">\(\boldsymbol{\mathbf{Z}}\)</span></li>
<li>APM asserts: <span class="math inline">\(Y_{i} = \boldsymbol{\mathbf{z}}_{i}^{\top}\boldsymbol{\alpha} + \epsilon_{i}.\)</span></li>
</ul>
<div class="fragment">
<ul>
<li>Tempting to estimate <span class="math inline">\(\boldsymbol{\alpha}\)</span> with least squares <span class="math display">\[
\textrm{argmin} \sum_{i = 1}^{n}{\left( Y_{i} - \boldsymbol{\mathbf{z}}_{i}^{\top}\boldsymbol{\alpha} \right)^{2}} .
\]</span></li>
</ul>
</div>
</section>
<section id="singularity" class="slide level2 smaller">
<h2>Singularity</h2>
<ul>
<li>Least squares problem does not have a unique solution!</li>
<li>Columns of <span class="math inline">\(\boldsymbol{\mathbf{Z}}\)</span> are linearly dependent
<ul>
<li>The first element in each row is equal to 1 (for intercept)</li>
<li>5 entries equal to 1 (for home players)</li>
<li>5 entries equal to -1 (for away players)</li>
</ul></li>
<li>If you know all but one column, you can perfectly determine that column</li>
<li><span class="math inline">\(\boldsymbol{\mathbf{Z}}^{\top}\boldsymbol{\mathbf{Z}}\)</span> not invertible</li>
</ul>
</section>
<section id="non-identifiability" class="slide level2">
<h2>Non-identifiability</h2>
<ul>
<li>Recall that the model asserts <span class="math display">\[
\begin{align}
Y_{i} &amp;= \alpha_{0} + \alpha_{h_{1}(i)} + \alpha_{h_{2}(i)} + \alpha_{h_{3}(i)} + \alpha_{h_{4}(i)} + \alpha_{h_{5}(i)} \\
~&amp;~~~~~~~~~~- \alpha_{a_{1}(i)} - \alpha_{a_{2}(i)} - \alpha_{a_{3}(i)} - \alpha_{a_{4}(i)} - \alpha_{a_{5}(i)} + \epsilon_{i},
\end{align}
\]</span></li>
<li>Imagine we add 5 to every <span class="math inline">\(\alpha_{j}\)</span>: right-hand side remains unchanged</li>
<li>So, we can’t hope to learn <span class="math inline">\(\alpha_{j}\)</span>’s exactly!</li>
</ul>
</section>
<section id="baseline-contrasts" class="slide level2 smaller">
<h2>Baseline Contrasts</h2>
<ul>
<li>Classify certain players as “baseline”-level (e.g., <span class="math inline">\(&lt; 250\)</span> minutes)</li>
<li>Re-number players so first <span class="math inline">\(p'\)</span> are non-baseline</li>
<li><strong>Assumption</strong>: <span class="math inline">\(\alpha_{j} = \mu\)</span> for all baseline players <span class="math inline">\(j &gt; p'\)</span>
<ul>
<li>All baseline players <strong>assumed</strong> to have the same underlying skill</li>
</ul></li>
</ul>
<div class="fragment">
<ul>
<li>For non-baseline <span class="math inline">\(j = 1, \ldots, p,\)</span> let <span class="math inline">\(\beta_{j} = \alpha_{j} - \mu\)</span></li>
<li><span class="math inline">\(\beta_{j}\)</span>: effect of replacing player <span class="math inline">\(j\)</span> <em>with a baseline player</em></li>
</ul>
</div>
</section>
<section id="a-re-parametrized-model" class="slide level2">
<h2>A Re-parametrized Model</h2>
<ul>
<li><span class="math inline">\(\tilde{\boldsymbol{\mathbf{Z}}}\)</span> be the <span class="math inline">\(n \times (p'+1)\)</span> submatrix of <span class="math inline">\(\boldsymbol{\mathbf{Z}}\)</span> s.t.
<ul>
<li>First column is all 1’s</li>
<li>Remaining columns: signed on-court indicators for non-baseline players</li>
</ul></li>
<li>Turns out:
<ul>
<li><span class="math inline">\(\tilde{\boldsymbol{\mathbf{Z}}}\boldsymbol{\beta} = \boldsymbol{\mathbf{Z}}\boldsymbol{\alpha}\)</span></li>
<li><span class="math inline">\(\tilde{\boldsymbol{\mathbf{Z}}}\)</span></li>
<li>Can minimize <span class="math inline">\(\sum_{i = 1}^{n}{\left(Y_{i} - \tilde{\boldsymbol{\mathbf{z}}}_{i}^{\top}\boldsymbol{\beta}\right)^{2}}\)</span></li>
</ul></li>
</ul>
<p><span class="math display">\[
\hat{\boldsymbol{\beta}} = \left( \tilde{\boldsymbol{\mathbf{Z}}}^{\top}\tilde{\boldsymbol{\mathbf{Z}}}\right)^{-1}\tilde{\boldsymbol{\mathbf{Z}}}^{\top}\boldsymbol{\mathbf{Y}}.
\]</span></p>
</section>
<section id="estimating-boldsymbolbeta" class="slide level2">
<h2>Estimating <span class="math inline">\(\boldsymbol{\beta}\)</span></h2>
<div class="panel-tabset">
<ul id="tabset-4" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-4-1">Defining Baselines</a></li><li><a href="#tabset-4-2">Estimating <span class="math inline">\(\boldsymbol{\beta}\)</span></a></li><li><a href="#tabset-4-3">Top-10 APM’s</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a></a>nonbaseline_id <span class="ot">&lt;-</span></span>
<span id="cb14-2"><a></a>  pm <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(minutes <span class="sc">&gt;=</span> <span class="dv">250</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-4"><a></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-4-2">
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-16" data-code-line-numbers="|1-3|4|5-6|"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy"><code class="sourceCode r"><span id="annotated-cell-16-1"><a href="#annotated-cell-16-1"></a>apm_df <span class="ot">&lt;-</span></span>
<span id="annotated-cell-16-2"><a href="#annotated-cell-16-2"></a>  rapm_data <span class="sc">|&gt;</span></span>
<span id="annotated-cell-16-3"><a href="#annotated-cell-16-3"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(tidyr<span class="sc">::</span><span class="fu">all_of</span>(<span class="fu">c</span>(<span class="st">"margin"</span>, nonbaseline_id)))</span>
<span id="annotated-cell-16-4"><a href="#annotated-cell-16-4"></a>apm_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(margin <span class="sc">~</span> ., <span class="at">data =</span> apm_df)</span>
<span id="annotated-cell-16-5"><a href="#annotated-cell-16-5"></a>beta0 <span class="ot">&lt;-</span> <span class="fu">coefficients</span>(apm_fit)[<span class="dv">1</span>]</span>
<span id="annotated-cell-16-6"><a href="#annotated-cell-16-6"></a>beta <span class="ot">&lt;-</span> <span class="fu">coefficients</span>(apm_fit)[<span class="sc">-</span><span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-4-3">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>                    Name      apm
1          Tobias Harris 17.01331
2         Mouhamed Gueye 16.79320
3           Devin Carter 16.60148
4             Trae Young 15.13287
5  Giannis Antetokounmpo 14.61082
6            Isaiah Wong 14.50091
7           Nikola Jokic 14.40837
8         Alperen Sengun 13.55544
9        Quenton Jackson 13.13962
10    Karl-Anthony Towns 13.13714</code></pre>
</div>
</div>
</div>
</div>
</div>
</section></section>
<section>
<section id="weighted-adjusted-plusminus" class="title-slide slide level1 center">
<h1>Weighted Adjusted Plus/Minus</h1>

</section>
<section id="missing-context" class="slide level2">
<h2>Missing Context</h2>
<ul>
<li>APM does not account for context &gt; “can artificially can artificially inflate the importance of performance in low-leverage situations, when the outcome of the game is essentially decided, while simultaneously deflating the importance of high-leverage performance, when the final outcome is still in question. For instance, point diﬀerential-based metrics model the home team’s lead dropping from 5 points to 0 points in the last minute of the first half in exactly the same way that they model the home team’s lead dropping from 30 points to 25 points in the last minute of the second half”.</li>
</ul>
</section>
<section id="a-weighted-version-of-apm" class="slide level2">
<h2>A Weighted Version of APM</h2>
<ul>
<li>Introduce weight <span class="math inline">\(w_{i}\)</span> for stint <span class="math inline">\(i\)</span></li>
<li>Find <span class="math inline">\(\tilde{\boldsymbol{\beta}}\)</span> minimizing <span class="math inline">\(w_{i}\left(Y_{i} - \tilde{\boldsymbol{\mathbf{z}}}_{i}^{\top}\boldsymbol{\beta}\right)^{2}\)</span></li>
<li>Solution: <span class="math inline">\(\boldsymbol{\mathbf{W}}\)</span> diagonal matrix w/ entries <span class="math inline">\(w_{i}\)</span> <span class="math display">\[
\hat{\boldsymbol{\beta}}_{w} = \left( \tilde{\boldsymbol{\mathbf{Z}}}^{\top}\tilde{\boldsymbol{\mathbf{Z}}}\right)^{-1}\tilde{\boldsymbol{\mathbf{Z}}}^{\top}\boldsymbol{\mathbf{W}}\boldsymbol{\mathbf{Y}}
\]</span></li>
</ul>
</section>
<section id="estimating-wapm" class="slide level2">
<h2>Estimating wAPM</h2>
<ul>
<li>Example weights:
<ul>
<li><span class="math inline">\(w_{i} = 1\)</span> if lead <span class="math inline">\(&lt; 10\)</span></li>
<li><span class="math inline">\(w_{i} = 0\)</span> if one team leads by <span class="math inline">\(&gt; 30\)</span> at start of <span class="math inline">\(i\)</span></li>
<li><span class="math inline">\(w_{i} = 1 - (\textrm{StartDiff} - 10)/20\)</span>: if <span class="math inline">\(10 \leq \textrm{lead} \leq 30\)</span></li>
</ul></li>
</ul>
<div class="panel-tabset">
<ul id="tabset-5" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-5-1">Defining Weights</a></li><li><a href="#tabset-5-2">Fit wAPM</a></li><li><a href="#tabset-5-3">Top-10 wAPM</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a></a>wapm_df <span class="ot">&lt;-</span></span>
<span id="cb16-2"><a></a>  rapm_data <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb16-4"><a></a>    <span class="at">start_diff =</span> <span class="fu">abs</span>(start_home_score <span class="sc">-</span> start_away_score), </span>
<span id="cb16-5"><a></a>    <span class="at">w =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb16-6"><a></a>      start_diff <span class="sc">&lt;</span> <span class="dv">10</span> <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb16-7"><a></a>      start_diff <span class="sc">&gt;</span> <span class="dv">30</span> <span class="sc">~</span> <span class="dv">0</span>, </span>
<span id="cb16-8"><a></a>      <span class="at">.default =</span> <span class="dv">1</span> <span class="sc">-</span> (start_diff<span class="dv">-10</span>)<span class="sc">/</span><span class="dv">20</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb16-9"><a></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(tidyr<span class="sc">::</span><span class="fu">all_of</span>(<span class="fu">c</span>(<span class="st">"margin"</span>, <span class="st">"w"</span>, nonbaseline_id)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-5-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb17" data-code-line-numbers="2-3|"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a></a>wapm_fit <span class="ot">&lt;-</span> </span>
<span id="cb17-2"><a></a>  <span class="fu">lm</span>(<span class="at">formula =</span> margin <span class="sc">~</span> . <span class="sc">-</span> w, </span>
<span id="cb17-3"><a></a>     <span class="at">weights =</span> w, </span>
<span id="cb17-4"><a></a>     <span class="at">data =</span> wapm_df) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-5-3">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>                Name     wapm
1       Devin Carter 19.48318
2      Tobias Harris 17.11044
3    Lauri Markkanen 15.20344
4     Mouhamed Gueye 14.76474
5         Trae Young 14.52393
6       Nikola Jokic 14.14573
7     Alperen Sengun 14.03023
8         OG Anunoby 13.96219
9  Jordan McLaughlin 13.73760
10      Jericho Sims 13.27850</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="looking-ahead" class="slide level2">
<h2>Looking Ahead</h2>
<ul>
<li>(w)APM is quite sensitive to certain choices:
<ul>
<li>Definition of baseline players</li>
<li>Choice of weights</li>
</ul></li>
<li>Constant baseline skill assumption is highly unsatisfactory</li>
<li>Issues due to inability to use least squares</li>
<li>Next time: alternative estimation strategy
<ul>
<li>Avoids having to specify baseline players</li>
<li>Estimates a latent strength for <em>all</em> players</li>
</ul></li>
</ul>


</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
            const codeEl = trigger.previousElementSibling.cloneNode(true);
            for (const childEl of codeEl.children) {
              if (isCodeAnnotation(childEl)) {
                childEl.remove();
              }
            }
            return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
            let selectedAnnoteEl;
            const selectorForAnnotation = ( cell, annotation) => {
              let cellAttr = 'data-code-cell="' + cell + '"';
              let lineAttr = 'data-code-annotation="' +  annotation + '"';
              const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
              return selector;
            }
            const selectCodeLines = (annoteEl) => {
              const doc = window.document;
              const targetCell = annoteEl.getAttribute("data-target-cell");
              const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
              const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
              const lines = annoteSpan.getAttribute("data-code-lines").split(",");
              const lineIds = lines.map((line) => {
                return targetCell + "-" + line;
              })
              let top = null;
              let height = null;
              let parent = null;
              if (lineIds.length > 0) {
                  //compute the position of the single el (top and bottom and make a div)
                  const el = window.document.getElementById(lineIds[0]);
                  top = el.offsetTop;
                  height = el.offsetHeight;
                  parent = el.parentElement.parentElement;
                if (lineIds.length > 1) {
                  const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
                  const bottom = lastEl.offsetTop + lastEl.offsetHeight;
                  height = bottom - top;
                }
                if (top !== null && height !== null && parent !== null) {
                  // cook up a div (if necessary) and position it 
                  let div = window.document.getElementById("code-annotation-line-highlight");
                  if (div === null) {
                    div = window.document.createElement("div");
                    div.setAttribute("id", "code-annotation-line-highlight");
                    div.style.position = 'absolute';
                    parent.appendChild(div);
                  }
                  div.style.top = top - 2 + "px";
                  div.style.height = height + 4 + "px";
                  div.style.left = 0;
                  let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
                  if (gutterDiv === null) {
                    gutterDiv = window.document.createElement("div");
                    gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                    gutterDiv.style.position = 'absolute';
                    const codeCell = window.document.getElementById(targetCell);
                    const gutter = codeCell.querySelector('.code-annotation-gutter');
                    gutter.appendChild(gutterDiv);
                  }
                  gutterDiv.style.top = top - 2 + "px";
                  gutterDiv.style.height = height + 4 + "px";
                }
                selectedAnnoteEl = annoteEl;
              }
            };
            const unselectCodeLines = () => {
              const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
              elementsIds.forEach((elId) => {
                const div = window.document.getElementById(elId);
                if (div) {
                  div.remove();
                }
              });
              selectedAnnoteEl = undefined;
            };
              // Handle positioning of the toggle
          window.addEventListener(
            "resize",
            throttle(() => {
              elRect = undefined;
              if (selectedAnnoteEl) {
                selectCodeLines(selectedAnnoteEl);
              }
            }, 10)
          );
          function throttle(fn, ms) {
          let throttle = false;
          let timer;
            return (...args) => {
              if(!throttle) { // first call gets through
                  fn.apply(this, args);
                  throttle = true;
              } else { // all the others get throttled
                  if(timer) clearTimeout(timer); // cancel #2
                  timer = setTimeout(() => {
                    fn.apply(this, args);
                    timer = throttle = false;
                  }, ms);
              }
            };
          }
            const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
            for (let i=0; i<annoteTargets.length; i++) {
              const annoteTarget = annoteTargets[i];
              const targetCell = annoteTarget.getAttribute("data-target-cell");
              const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
              const contentFn = () => {
                const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
                if (content) {
                  const tipContent = content.cloneNode(true);
                  tipContent.classList.add("code-annotation-tip-content");
                  return tipContent.outerHTML;
                }
              }
              const config = {
                allowHTML: true,
                content: contentFn,
                onShow: (instance) => {
                  selectCodeLines(instance.reference);
                  instance.reference.classList.add('code-annotation-active');
                  window.tippy.hideAll();
                },
                onHide: (instance) => {
                  unselectCodeLines();
                  instance.reference.classList.remove('code-annotation-active');
                },
                maxWidth: 300,
                delay: [50, 0],
                duration: [200, 0],
                offset: [5, 10],
                arrow: true,
                appendTo: function(el) {
                  return el.parentElement.parentElement.parentElement;
                },
                interactive: true,
                interactiveBorder: 10,
                theme: 'light-border',
                placement: 'right',
                popperOptions: {
                  modifiers: [
                  {
                    name: 'flip',
                    options: {
                      flipVariations: false, // true by default
                      allowedAutoPlacements: ['right'],
                      fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
                    },
                  },
                  {
                    name: 'preventOverflow',
                    options: {
                      mainAxis: false,
                      altAxis: false
                    }
                  }
                  ]        
                }      
              };
              window.tippy(annoteTarget, config); 
            }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    <script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
    (function() {
      let previousOnload = window.onload;
      window.onload = () => {
        if (previousOnload) {
          previousOnload();
        }
        lightboxQuarto.on('slide_before_load', (data) => {
          const { slideIndex, slideNode, slideConfig, player, trigger } = data;
          const href = trigger.getAttribute('href');
          if (href !== null) {
            const imgEl = window.document.querySelector(`a[href="${href}"] img`);
            if (imgEl !== null) {
              const srcAttr = imgEl.getAttribute("src");
              if (srcAttr && srcAttr.startsWith("data:")) {
                slideConfig.href = srcAttr;
              }
            }
          } 
        });
      
        lightboxQuarto.on('slide_after_load', (data) => {
          const { slideIndex, slideNode, slideConfig, player, trigger } = data;
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(slideNode);
          }
        });
      
      };
      
    })();
              </script>
    

</body></html>